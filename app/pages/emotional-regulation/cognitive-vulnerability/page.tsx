'use client';
import Link from 'next/link';

import { useRouter } from 'next/navigation';
import { useState, useEffect } from 'react';
import { BackButton } from '@/components/shared/BackButton';

export default function CognitiveVulnerabilityPage() {
  const router = useRouter();
  const [activeTooltip, setActiveTooltip] = useState<string | null>(null);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      const target = event.target as HTMLElement;
      if (!target.closest('.tooltip-container') && !target.closest('.tooltip-button')) {
        setActiveTooltip(null);
      }
    };

    if (activeTooltip) {
      document.addEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [activeTooltip]);

  const toggleTooltip = ({ tooltipId }: { tooltipId: string }) => {
    if (activeTooltip === tooltipId) {
      setActiveTooltip(null);
    } else {
      setActiveTooltip(tooltipId);
    }
  };

  const handleBack = () => {
    router.back();
  };

  const handleReturnToLanding = () => {
    router.push('/pages/landing-page');
  };

  return (
    <div className="container mx-auto px-4 py-8 pb-24">
      <div className="flex flex-col items-center justify-center min-h-[calc(100vh-4rem)]">
        <div className="w-full max-w-3xl">
          <h1 className="text-4xl font-bold mb-8 text-center text-purple-800">
            Emotions & Cognitive Vulnerability (DBT Skill Page)
          </h1>

          <div className="bg-purple-50 backdrop-blur-sm rounded-lg border border-purple-200 p-8 shadow-lg space-y-6">
            <div>
              <h2 className="text-2xl font-semibold mb-4 text-purple-800">
                What this skill is
              </h2>
              <p className="text-gray-700 mb-4">
                Cognitive vulnerability means your thought patterns can make emotions hit harder and last longer—especially when you're stressed, tired, triggered, or overwhelmed. A single thought like "I'm a fraud" can rapidly produce shame, fear, anger, hopelessness, and then pull you into actions that don't help (shutting down, lashing out, avoiding, spiraling).
              </p>
              <p className="text-gray-700">
                This page helps you notice distorted thoughts early, then shift them into something more accurate and workable using a DBT-style approach (balanced, reality-based, and compassionate—not "positive vibes only"). Cognitive distortions (like all-or-nothing thinking and overgeneralization) are well-documented patterns that can intensify anxiety/depression when they run unchecked.
              </p>
            </div>

            <div className="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
              <h3 className="text-xl font-semibold mb-3 text-gray-800">
                Why this matters (especially for neurodivergent brains)
              </h3>
              <p className="text-gray-700 mb-3">
                When you're autistic/ADHD/trauma-impacted, it can be harder to "catch" thoughts before the emotion surge—because:
              </p>
              <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4">
                <li>Interoception + alexithymia can make early emotion signals faint or confusing (you feel the shutdown or panic before you can name the feeling).</li>
                <li>Under overload, your brain may default to threat rules ("unsafe," "rejected," "I messed up") and lock onto one interpretation (tunnel vision / monotropism style attention).</li>
                <li>Rejection sensitivity can make neutral cues feel like proof you're disliked or failing.</li>
              </ul>
              <p className="text-gray-700 mt-3">
                So we build external scaffolding: tiny steps, written prompts, and "good-enough" reframes.
              </p>
            </div>

            <div>
              <h2 className="text-2xl font-semibold mb-4 text-purple-800">
                When to use this skill
              </h2>
              <p className="text-gray-700 mb-3">Use it when you notice:</p>
              <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4 mb-4">
                <li>Your emotions are "too big for the situation"</li>
                <li>You're spiraling into shame/panic/anger</li>
                <li>You keep replaying a moment</li>
                <li>Your brain is generating harsh "truths" ("always," "never," "everyone," "nothing")</li>
                <li>You feel stuck in catastrophizing or mind-reading</li>
              </ul>
              <p className="text-gray-700 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                Don't start here if you're in full crisis (can't think, dissociating, panic peak). Start with STOP/<Link href="/pages/distress-tolerance/tipp" className="text-blue-600 hover:text-blue-800 underline">TIPP</Link>/breathing/<Link href="/pages/distress-tolerance/soothe" className="text-blue-600 hover:text-blue-800 underline">self-soothe</Link> first, then come back to this page when the intensity drops.
              </p>
            </div>

            <div>
              <h2 className="text-2xl font-semibold mb-4 text-purple-800">
                Step-by-step: The 6-Minute Cognitive Reset
              </h2>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Step 0 — Make it ND-friendly (10 seconds)
                </h3>
                <p className="text-gray-700 mb-2 font-medium">Pick one support:</p>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4">
                  <li>open Notes app / paper</li>
                  <li>set a 3–6 minute timer</li>
                  <li>hold a grounding object (cold can, textured item)</li>
                  <li>reduce sensory load (dim light, earbuds)</li>
                </ul>
                <p className="text-gray-700 mt-3">
                  Goal: not "fix my brain," just slow the spiral by 10%.
                </p>
              </div>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Step 1 — Capture the thought verbatim (30 seconds)
                </h3>
                <p className="text-gray-700 mb-2">Write the sentence your brain is shouting.</p>
                <p className="text-gray-700 mb-2 font-medium">Examples:</p>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4">
                  <li>"I'm such a fraud."</li>
                  <li>"They're mad at me."</li>
                  <li>"I ruined everything."</li>
                  <li>"This will never get better."</li>
                </ul>
                <p className="text-gray-700 mt-3">
                  If you can't find words, write keywords: fraud / unsafe / rejected / trapped.
                </p>
              </div>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Step 2 — Name the distortion (60 seconds)
                </h3>
                <p className="text-gray-700 mb-3">Choose the closest match (you don't have to be perfect):</p>

                <div className="mb-3">
                  <p className="text-gray-700 font-semibold mb-1">A) All-or-Nothing Thinking</p>
                  <p className="text-gray-700 ml-4 mb-1">Extreme categories: total failure / total success</p>
                  <p className="text-gray-700 ml-4 text-sm">"I'm a loser." "I'm bad at my job."</p>
                </div>

                <div className="mb-3">
                  <p className="text-gray-700 font-semibold mb-1">B) Maximization / Minimization</p>
                  <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4">
                    <li>Maximization: blowing the negative up: "Everyone thinks I'm weird."</li>
                    <li>Minimization: shrinking the positive: "The promotion doesn't matter."</li>
                  </ul>
                </div>

                <div>
                  <p className="text-gray-700 font-semibold mb-1">C) Overgeneralization</p>
                  <p className="text-gray-700 ml-4 mb-1">One bad event → "it always happens"</p>
                  <p className="text-gray-700 ml-4 text-sm">"I failed once, I'll fail forever."</p>
                </div>
                <p className="text-gray-700 mt-3 text-sm italic">
                  (Other common ones you may notice: catastrophizing, mind-reading, "should" statements.)
                </p>
              </div>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Step 3 — <Link href="/pages/flowchart/check-facts" className="text-blue-600 hover:text-blue-800 underline">Check the facts</Link> (2 minutes)
                </h3>
                <p className="text-gray-700 mb-2 font-medium">Answer only these:</p>
                <ol className="list-decimal list-inside space-y-1 text-gray-700 ml-4 mb-3">
                  <li>What happened (camera footage)?
                    <p className="text-gray-700 ml-6 text-sm">No interpretations. Just observable facts.</p>
                  </li>
                  <li>What are 2–3 other possible explanations?
                    <p className="text-gray-700 ml-6 text-sm">Even if you don't like them.</p>
                  </li>
                  <li>What evidence supports my thought?
                    <p className="text-gray-700 ml-6 text-sm">One or two bullets.</p>
                  </li>
                  <li>What evidence does not support it?
                    <p className="text-gray-700 ml-6 text-sm">One or two bullets.</p>
                  </li>
                </ol>
                <p className="text-gray-700 mb-2 font-medium">ND shortcut: If this is hard, ask:</p>
                <p className="text-gray-700 ml-4 font-semibold">
                  "What would I say if a friend I loved had this thought?"
                </p>
              </div>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Step 4 — Build the "objective response" (1 minute)
                </h3>
                <p className="text-gray-700 mb-3">Not positive. Accurate + usable.</p>
                <p className="text-gray-700 mb-2 font-medium">Use one of these templates:</p>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4 mb-3">
                  <li>"A more complete truth is: ______."</li>
                  <li>"It makes sense I feel ______. The facts are ______."</li>
                  <li>"This is my brain predicting. What I know is ______."</li>
                  <li>"One mistake ≠ my identity. Next step: ______."</li>
                </ul>
                <p className="text-gray-700 mb-2 font-medium">Examples:</p>
                <div className="space-y-2 ml-4">
                  <p className="text-gray-700"><strong>Thought:</strong> "I'm a fraud."<br />
                  <strong>Objective response:</strong> "I made a mistake / got feedback. I've also succeeded before. Next step is fixing one part."</p>
                  <p className="text-gray-700"><strong>Thought:</strong> "They hate me."<br />
                  <strong>Objective response:</strong> "I don't have confirmation. There are other explanations (busy, distracted). I can check in once calmly."</p>
                </div>
              </div>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Step 5 — Choose one effective action (60 seconds)
                </h3>
                <p className="text-gray-700 mb-2">Pick one small action that matches the facts:</p>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4">
                  <li>clarify / ask a question</li>
                  <li>take a break + regulate body</li>
                  <li>do the next tiny task step</li>
                  <li>write a repair text (short, not a confession spiral)</li>
                  <li>postpone problem-solving until you're regulated</li>
                </ul>
                <p className="text-gray-700 mt-3">
                  If your brain wants a huge plan, shrink it to 2 minutes.
                </p>
              </div>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Step 6 — Close the loop (20 seconds)
                </h3>
                <p className="text-gray-700 mb-2 font-medium">Say (out loud if possible):</p>
                <p className="text-gray-700 ml-4 mb-3 font-semibold">
                  "I'm noticing a distortion. I'm choosing a more complete truth."
                </p>
                <p className="text-gray-700 mb-2">Then do a brief body reset:</p>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4">
                  <li>exhale longer than inhale (3 breaths)</li>
                  <li>unclench jaw / drop shoulders</li>
                </ul>
              </div>

              <div className="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Mini Worksheet (copy/paste)
                </h3>
                <div className="space-y-1 text-gray-700 text-sm">
                  <p>Trigger / situation:</p>
                  <p>Emotion (0–10):</p>
                  <p>Body cues:</p>
                  <p>Thought (verbatim):</p>
                  <p>Distortion:</p>
                  <p>Facts (camera footage):</p>
                  <p>Other explanations (2–3):</p>
                  <p>Evidence for:</p>
                  <p>Evidence against:</p>
                  <p>Objective response:</p>
                  <p>One effective action (2 minutes):</p>
                  <p>Emotion now (0–10):</p>
                </div>
              </div>

              <div className="mb-6">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Common neurodivergent "gotchas" (and fixes)
                </h3>
                <div className="space-y-3">
                  <div>
                    <p className="text-gray-700 font-semibold mb-1">"I can't find the thought—only the feeling."</p>
                    <p className="text-gray-700 ml-4">
                      That can happen with alexithymia/interoception differences.<br />
                      <strong>Fix:</strong> start with body + urge:
                      <ul className="list-disc list-inside ml-6 mt-1">
                        <li>Body: "chest tight, buzzing, jaw clench"</li>
                        <li>Urge: "hide / apologize / explode / disappear"</li>
                      </ul>
                      Then ask: "What story would explain this urge?"
                    </p>
                  </div>
                  <div>
                    <p className="text-gray-700 font-semibold mb-1">"My brain won't accept the reframe."</p>
                    <p className="text-gray-700 ml-4">
                      <strong>Fix:</strong> don't argue. Use a bridge thought:
                      <ul className="list-disc list-inside ml-6 mt-1">
                        <li>"I don't know yet."</li>
                        <li>"This is one possible story."</li>
                        <li>"Let's gather data."</li>
                      </ul>
                    </p>
                  </div>
                  <div>
                    <p className="text-gray-700 font-semibold mb-1">"I'm looping."</p>
                    <p className="text-gray-700 ml-4">
                      <strong>Fix:</strong> add structure:
                      <ul className="list-disc list-inside ml-6 mt-1">
                        <li>timer 3 minutes</li>
                        <li>write only bullets</li>
                        <li>end with a physical regulation step</li>
                      </ul>
                    </p>
                  </div>
                </div>
              </div>

              <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                <h3 className="text-xl font-semibold mb-3 text-gray-800">
                  Practice plan (low pressure)
                </h3>
                <ul className="list-disc list-inside space-y-1 text-gray-700 ml-4">
                  <li>Practice once a day on a small annoyance (traffic, minor awkward moment).</li>
                  <li>When it works, write one line: "What helped?"</li>
                  <li>Over time you'll catch distortions earlier—before they become a full-body storm.</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <BackButton onClick={handleBack} />
      <button
        onClick={handleReturnToLanding}
        className="flex flex-col gap-2 md:fixed md:bottom-20 right-0 md:right-6 px-4 md:px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-lg transition-colors duration-200"
      >
        Return to Landing
      </button>
    </div>
  );
}
